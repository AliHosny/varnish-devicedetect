Install and configure
=====================

Add the following to your VCL to enable classification::

"""
include "devicedetect.vcl";
sub vcl_recv {
    # only do device detection on non-static content.
    if (!req.url ~ "^/[^?]+\.(jpeg|jpg|png|gif|ico|js|css|txt|gz|zip|lzma|bz2|tgz|tbz|html|htm)(\?.*|)$") {
        detectdevice;
    }
}

sub vcl_hash {
    # add the device classification to the hash, so clients get the correct cached object
    if (req.http.X-hash-input) set req.hash += req.http.X-hash-input;
}
"""

When testing backends you can also add the following include:
"""
include "devicedetect.vcl";
"""

This will create the /set_ua_device/ URL which you can use to override the contents of X-UA-Device into the
backend. 

Example: enable devicedetection, go to /set_ua_device/mobile-iphone . Afterwards, access your site as usual. The backend will now think that your browser is an iphone, and if configured to it, output different content.

There is an example web server in backend/ that runs on port 8000 and replies differently depending on X-UA-Device. Run
it with:

    cd backend
    ./example_backend.py

Now you can access it through:
   
    http://localhost:8000/devicetest/ 
    OR
    http://localhost:6081/devicetest/ # exchange 6081 for your varnish listening port.

Happy devicedetecting.
